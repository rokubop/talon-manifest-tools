# Manifest Generator for Talon

![Version](https://img.shields.io/badge/version-2.0.0-blue)
![Status](https://img.shields.io/badge/status-preview-orange)

Provides scripts for generating package-like files for your Talon repo: `manifest.json` with dependencies and contributions, `_version.py` with version actions and dependency validation, `README.md` with shield badges and installation instructions, and more.

## Installation

Clone this repo into your [Talon](https://talonvoice.com/) user directory:

```sh
# mac and linux
cd ~/.talon/user

# windows
cd ~/AppData/Roaming/talon/user

git clone https://github.com/rokubop/talon-manifest-generator
```

## Scripts

**Quick start:** Use `generate_all.py` to run all generators at once, or run individual scripts for specific tasks.

### generate_manifest.py
Parses Python files using AST to detect Talon actions, settings, tags, lists, modes, scopes, and captures you contribute or depend on. Scans user directory to find all other packages with manifests to build an index of available packages. Maps your imported actions/settings to specific packages and their versions. Creates or updates `manifest.json` with all discovered information, preserving your manual edits to fields like name, description, etc.

```bash
python generate_manifest.py ../talon-repo
```

### generate_version.py
Generates a `_version.py` file that exposes your `manifest.json` package version as a Talon action (e.g., `actions.user.my_package_version()`). Also includes automatic dependency validation on Talon startup, printing clear error messages if dependencies are missing or outdated with installation/update instructions for other packages that also have a `manifest.json` and `_version.py` generated by this generator.

```bash
python generate_version.py ../talon-repo
```

### generate_readme.py
Creates or updates `README.md` files with shield badges, description, and installation instructions. For existing READMEs, only updates the shield badges (preserves your custom installation instructions). Automatically includes `preview.png` if it exists in the package directory.

```bash
python generate_readme.py ../talon-repo
```

### generate_shields.py
Generates or updates shield badges in your `README.md` based on your `manifest.json`. Badges show package status, version, Talon Beta requirement, and tags. If no README exists, prints badges to console for copy/paste.

```bash
python generate_shields.py ../talon-repo
```

### generate_install_block.py
Outputs formatted installation instructions for your package based on your `manifest.json`, including dependency information. Useful for quickly generating README installation sections. Only supports single directory.

```bash
python generate_install_block.py ../talon-repo
```

### generate_all.py
Runs all generators in sequence: `generate_manifest.py`, `generate_version.py`, and `generate_readme.py`. Convenient way to update all generated files at once. Smart about not recreating files unnecessarily - only updates `_version.py` if the version changed, only updates shields in existing READMEs (preserves your custom content), and preserves manual edits to `manifest.json`.

```bash
python generate_all.py ../talon-repo
```

### Additional notes
You can provide multiple folders to most scripts
```bash
python generate_all.py ../talon-repo-1 ../talon-repo-2
```

## Example Manifest Output

```json
{
  "name": "talon-my-package",
  "title": "My Package",
  "description": "A brief description of what the package does",
  "version": "1.0.0",
  "namespace": "user.my_package",
  "github": "https://github.com/user/my-package",
  "preview": "",
  "status": "experimental",
  "author": "Your Name",
  "tags": ["productivity", "editing"],
  "dependencies": {
    "talon-ui-elements": {
      "version": "0.10.0",
      "namespace": "user.ui_elements",
      "github": "https://github.com/user/talon-ui-elements"
    }
  },
  "devDependencies": {},
  "contributes": {
    "actions": ["user.my_package_action"],
    "settings": ["user.my_package_setting"]
  },
  "depends": {
    "actions": ["user.ui_elements_show"]
  },
  "requiresTalonBeta": false,
  "_generator": "talon-manifest-generator",
  "_generatorVersion": "2.0.0",
  "_generatorRequiresVersionAction": true,
  "_generatorStrictNamespace": true
}
```

### Manifest Fields

| Field | Description |
|-------|-------------|
| name | Package identifier (defaults to folder name, preserved on updates). Recommendation for folder & name: prefix with "talon-". |
| title | Human-readable package title. Recommendation: "Title Case" format |
| description | Brief description of package functionality |
| version | Semantic version number (Major.Minor.Patch) |
| namespace | Naming prefix for all talon actions in this package (e.g. `user.ui_elements` means all actions in this package are `user.ui_elements_*`). Best practice: all your actions should use the same namespace. Set `_generatorStrictNamespace` to false to allow multiple namespaces and skip validation warnings. |
| github | GitHub repository URL |
| preview | Preview image URL |
| author | Package author name |
| status | Package status/category. Can be any value, but these get automatic shield colors: "reference" (personal config/examples, not meant to be used directly), "prototype" (proof of concept, testing ideas), "experimental" (early stage, expect rough edges), "preview" (functional but still improving), "stable" (production-ready, safe to depend on), "deprecated" (stop using, migrate to alternative), "archived" (no longer maintained) |
| tags | Arbitrary category tags for the package |
| dependencies | Auto-generated. Required packages (other packages that also have `manifest.json` and `_version.py` generated by this generator) as dict mapping package name to object with `version` (minimum version required, e.g. "0.10.0" means 0.10.0 or higher), `namespace`, and `github` fields. Once set, versions are preserved - update manually if needed. |
| devDependencies | Dev-only dependencies (manually move items here from `dependencies` if only needed for testing/development) |
| contributes | Auto-generated. Actions/settings/tags/modes/etc. this package provides |
| depends | Auto-generated. Actions/settings/tags/modes/etc. this package uses |
| requiresTalonBeta | Auto-detected on first run (parrot/face/deck in .talon files, ctx.dynamic_list/ctx.selections in .py files). Once checked and set, the value is preserved on subsequent runs - manual changes are respected. |
| validateDependencies | Whether to validate dependencies on Talon start (default: true if dependencies exist, omitted otherwise). Set to false to disable dependency validation. |
| _generator | Generator e.g. "talon-manifest-generator" |
| _generatorVersion | Version of the generator |
| _generatorRequiresVersionAction | Whether the generator should require a version action (default: true if namespace exists). Set to false to disable version action requirement check |
| _generatorStrictNamespace | Whether the generator should validate namespace consistency (default: true). Set to false to allow multiple namespaces and skip validation warnings. Useful for collection packages like talon-community |

Most fields are preserved across regenerations, but `contributes`, `depends`, and `dependencies` (except for `version`) are auto-generated each time.

## Troubleshooting

### Python Version Error

The script requires **Python 3.12 or higher**. If you get a version error, you can use Talon's bundled Python 3.13 instead:

**Windows:**
```bash
"C:\Program Files\Talon\python.exe" generate_manifest.py ../talon-package
```

**Mac:**
```bash
/Applications/Talon.app/Contents/Resources/python/bin/python3 generate_manifest.py ../talon-package
```

**Linux:**
```bash
~/.talon/bin/python3 generate_manifest.py ../talon-package
```